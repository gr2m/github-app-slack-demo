# Snapshot report for `test/unit/api-github-webhooks.test.js`

The actual snapshot is saved in `api-github-webhooks.test.js.snap`.

Generated by [AVA](https://avajs.dev).

## setupApp

> logs

    [
      [
        'info',
        'Setting up app',
      ],
      [
        'info',
        'Verifying app access',
      ],
      [
        'info',
        {
          slug: '<slug>',
          url: '<html-url>',
        },
        'Authenticated',
      ],
      [
        'info',
        'registering webhook handlers',
      ],
    ]

## setupApp() - called twice

> logs

    [
      [
        'info',
        'Setting up app',
      ],
      [
        'info',
        'Verifying app access',
      ],
      [
        'info',
        {
          slug: '<slug>',
          url: '<html-url>',
        },
        'Authenticated',
      ],
      [
        'info',
        'registering webhook handlers',
      ],
    ]

## setupApp() with error

> logs

    [
      [
        'info',
        'Setting up app',
      ],
      [
        'info',
        'Verifying app access',
      ],
      [
        'error',
        HttpError (RequestError) {
          request: {
            headers: {
              accept: 'application/vnd.github.v3+json',
              authorization: 'bearer [REDACTED]',
            },
            method: 'GET',
            url: 'https://api.github.com/app',
          },
          response: {
            data: '',
            headers: {},
            status: 401,
            url: '',
          },
          status: 401,
          message: '',
        },
        'Failed to set up app',
      ],
    ]

## setupApp() with error - called twice

> logs

    [
      [
        'info',
        'Setting up app',
      ],
      [
        'info',
        'Verifying app access',
      ],
      [
        'error',
        HttpError (RequestError) {
          request: {
            headers: {
              accept: 'application/vnd.github.v3+json',
              authorization: 'bearer [REDACTED]',
            },
            method: 'GET',
            url: 'https://api.github.com/app',
          },
          response: {
            data: '',
            headers: {},
            status: 401,
            url: '',
          },
          status: 401,
          message: '',
        },
        'Failed to set up app',
      ],
    ]

## POST /api/github-webhooks

> response

    {
      statusCode: 200,
    }

> app.webhooks.verifyAndReceive() calls

    [
      Arguments [
        {
          id: '<event-delivery-guid>',
          name: '<event-name>',
          payload: '<event-payload>',
          signature: '<event-delivery-signature>',
        },
      ],
    ]

> githubApp() calls

    Function {}

> logs

    [
      [
        'info',
        {
          'event.id': '<event-delivery-guid>',
          'event.name': '<event-name>',
          'event.signature': '<event-delivery-signature>',
        },
        'Webhook received',
      ],
    ]

## POST /api/github-webhooks with timeout

> response

    {
      body: '{"ok":true}',
      statusCode: 202,
    }

> app.webhooks.verifyAndReceive() calls

    [
      Arguments [
        {
          id: '<event-delivery-guid>',
          name: '<event-name>',
          payload: '<event-payload>',
          signature: '<event-delivery-signature>',
        },
      ],
    ]

> githubApp() calls

    Function {}

> logs

    [
      [
        'info',
        {
          'event.id': '<event-delivery-guid>',
          'event.name': '<event-name>',
          'event.signature': '<event-delivery-signature>',
        },
        'Webhook received',
      ],
    ]

## error in app.webhooks.verifyAndReceive()

> response

    {
      body: 'Error: <verifyAndReceive-error>',
      statusCode: 400,
    }

> logs

    [
      [
        'info',
        {
          'event.id': '<event-delivery-guid>',
          'event.name': '<event-name>',
          'event.signature': '<event-delivery-signature>',
        },
        'Webhook received',
      ],
      [
        'error',
        {
          err: AggregateError {
            message: 'Hello',
          },
        },
        'Handler error',
      ],
    ]

## unexpected error in app.webhooks.verifyAndReceive()

> response

    {
      body: 'Error: An unexpected error occurred',
      statusCode: 500,
    }

> logs

    [
      [
        'info',
        {
          'event.id': '<event-delivery-guid>',
          'event.name': '<event-name>',
          'event.signature': '<event-delivery-signature>',
        },
        'Webhook received',
      ],
      [
        'error',
        {
          err: AggregateError {
            message: 'Hello',
          },
        },
        'Handler error',
      ],
    ]

## Unexpected error in handler

> response

    {
      body: 'Error: An unexpected error occurred',
      statusCode: 500,
    }

> logs

    [
      [
        'info',
        {
          'event.id': '<event-delivery-guid>',
          'event.name': '<event-name>',
          'event.signature': '<event-delivery-signature>',
        },
        'Webhook received',
      ],
      [
        'error',
        {
          err: Error {
            message: 'oops',
          },
        },
        'Handler error',
      ],
    ]

## GET /api/github-webhooks

> response

    {
      body: '{"error":"Method not allowed"}',
      statusCode: 405,
    }

> logs

    [
      [
        'info',
        {
          method: 'GET',
        },
        'Method not allowed',
      ],
    ]
